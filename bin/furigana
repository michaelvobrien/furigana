#!/usr/bin/env ruby
# -*- coding: utf-8 -*-
require 'furigana'
require 'ostruct'
require 'optparse'

module Furigana
  class CLI
    def initialize
      @settings = OpenStruct.new
      @settings.format = :text
    end

    def parse_options
      OptionParser.new do |opts|
        opts.banner = "Usage: furigana [options] [file]"

        opts.on("--text", "Add furigana and output text (default)") do
          @settings.format = :text
        end
        opts.on("--html", "Add furigana and output HTML") do
          @settings.format = :html
        end
        opts.on("--json", "Add furigana and output JSON") do
          @settings.format = :json
        end
        opts.on_tail("-h", "--help", "Show this message") do
          puts opts
          exit
        end
        opts.on_tail("--version", "Show version") do
          puts Furigana::VERSION
          exit
        end
      end.parse!
    end

    def start
      parse_options

      case @settings.format
      when :text
        puts Furigana::Formatter::Text.format(Furigana::Parser.new.reading(ARGF.read))
      when :html
        puts Furigana::Formatter::HTML.format(Furigana::Parser.new.reading(ARGF.read))
      when :json
        puts Furigana::Formatter::JSON.format(Furigana::Parser.new.reading(ARGF.read))
      end
    end
  end
end

Furigana::CLI.new.start
